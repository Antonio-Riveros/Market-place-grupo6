{% extends "base.html" %}
{% block title %}Productos ‚Ä¢ Mercadito{% endblock %}

{% block content %}
<h2 style="text-align:center; margin-bottom:20px;">Todos los productos</h2>

{% if user.is_authenticated %}
  <p style="text-align:center;">
    <a href="{% url 'market:productcreate' %}" class="btn-add">‚ûï Publicar producto</a>
  </p>
{% endif %}

<!-- FILTROS -->
<form method="get" style="text-align:center; margin-bottom:20px;">
  <label for="category">Categor√≠a:</label>
  <select name="category" id="category">
    <option value="">Todas</option>
    {% for cat in categories %}
      <option value="{{ cat }}" {% if request.GET.category == cat %}selected{% endif %}>{{ cat|capfirst }}</option>
    {% endfor %}
  </select>

  <label for="order">Ordenar por precio:</label>
  <select name="order" id="order">
    <option value="">Sin ordenar</option>
    <option value="asc" {% if request.GET.order == "asc" %}selected{% endif %}>Menor a Mayor</option>
    <option value="desc" {% if request.GET.order == "desc" %}selected{% endif %}>Mayor a Menor</option>
  </select>

  <button type="submit" class="btn-primary">Filtrar</button>
</form>

<div class="card-grid">
  {% for product in products %}
    <div class="card">
      {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.title }}">
      {% endif %}
      <h3>{{ product.title }}</h3>
      <p>{{ product.description|truncatewords:20 }}</p>
      <p class="price"><strong>${{ product.price }}</strong></p>

      {% if user.is_authenticated %}
        <a href="{% url 'market:add-to-cart' product.id %}" class="btn-primary">üõí Agregar al carrito</a>

        {% if user == product.seller %}
          <div style="margin-top:10px;">
            <a href="{% url 'market:product-edit' product.id %}" class="btn-edit">‚úèÔ∏è Editar</a>
            <a href="{% url 'market:product-delete' product.id %}" class="btn-delete">üóëÔ∏è Eliminar</a>
          </div>
        {% endif %}

      {% else %}
        <a href="{% url 'account_login' %}" class="btn-secondary">Inicia sesi√≥n para comprar</a>
      {% endif %}
    </div>
  {% empty %}
    <p style="text-align:center;">No hay productos disponibles.</p>
  {% endfor %}
</div>

<style>
.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 20px;
  font-family: 'Arial', sans-serif;
}

.card {
  background: #f9f9f9;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  padding: 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

.card img {
  width: 100%;
  max-height: 200px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
}

.card h3 {
  margin: 10px 0 5px;
  font-size: 1.1rem;
  color: #333;
  text-align: center;
}

.card p {
  margin: 5px 0;
  color: #555;
  text-align: center;
}

.card .price {
  font-size: 1.1rem;
  color: #007bff;
  margin-bottom: 10px;
}

.btn-add,
.btn-primary,
.btn-secondary,
.btn-edit,
.btn-delete {
  display: inline-block;
  padding: 8px 15px;
  border-radius: 20px;
  text-decoration: none;
  font-size: 0.95rem;
  transition: background 0.3s;
}

.btn-add { background-color: #28a745; color: white; }
.btn-add:hover { background-color: #218838; }

.btn-primary { background-color: #007bff; color: white; }
.btn-primary:hover { background-color: #0056b3; }

.btn-secondary { background-color: #6c757d; color: white; }
.btn-secondary:hover { background-color: #5a6268; }

.btn-edit { background-color: #ffc107; color: white; margin-right: 5px; }
.btn-edit:hover { background-color: #e0a800; }

.btn-delete { background-color: #dc3545; color: white; }
.btn-delete:hover { background-color: #c82333; }
</style>
{% endblock %}
