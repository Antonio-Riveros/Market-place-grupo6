{% extends "base.html" %}
{% block title %}Editar perfil{% endblock %}
{% load widget_tweaks %}
{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow border-0 rounded-4">
        <div class="card-body p-4">
          <h3 class="text-center mb-4">Editar perfil</h3>

          <!-- Avatar -->
          <div class="text-center mb-4">
            {% if request.user.profile.avatar %}
              <img src="{{ request.user.profile.avatar.url }}" alt="Avatar" class="rounded-circle border border-primary" style="width:120px; height:120px; object-fit:cover;">
            {% else %}
              <img src="https://ui-avatars.com/api/?name={{ request.user.username }}&background=random" alt="Avatar" class="rounded-circle border border-primary" style="width:120px; height:120px; object-fit:cover;">
            {% endif %}
            <p class="text-muted mt-2">Subí una nueva foto para actualizar tu avatar</p>
          </div>

          <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            {% for field in form %}
              <div class="mb-3">
                {{ field.label_tag }}
                {{ field|add_class:"form-control" }}
                {% if field.help_text %}
                  <small class="form-text text-muted">{{ field.help_text }}</small>
                {% endif %}
                {% for error in field.errors %}
                  <div class="text-danger">{{ error }}</div>
                {% endfor %}
              </div>
            {% endfor %}

            <button type="submit" class="btn btn-primary w-100 mt-3">Guardar cambios</button>
          </form>

          <div class="text-center mt-3">
            <a href="{% url 'profile' %}" class="text-decoration-none">⬅ Volver al perfil</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Opcional: puedes agregar preview en vivo del avatar al subir imagen
  const avatarInput = document.querySelector('input[type="file"]');
  const avatarImg = document.querySelector('.card-body img.rounded-circle');
  if(avatarInput && avatarImg){
    avatarInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = e => avatarImg.src = e.target.result;
        reader.readAsDataURL(file);
      }
    });
  }
</script>
{% endblock %}
